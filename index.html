<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat With Us</title>
    <!-- Tailwind CSS CDN for easy styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5; /* Light gray background */
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <div class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-2xl border border-gray-200">
        <h1 class="text-4xl font-extrabold text-center text-gray-900 mb-8 tracking-tight">
            Chat with Us
        </h1>

        <!-- Personality Selection -->
        <div class="mb-6">
            <label for="personalitySelect" class="block text-lg font-medium text-gray-700 mb-2">
                Choose one of us:
            </label>
            <div class="relative">
                <select id="personalitySelect"
                        class="block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-base appearance-none transition duration-150 ease-in-out">
                    <!-- Options will be populated by JavaScript -->
                </select>
                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-gray-700">
                    <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                </div>
            </div>
        </div>

        <!-- User Prompt Input -->
        <div class="mb-6">
            <label for="userPrompt" class="block text-lg font-medium text-gray-700 mb-2">
                Ask us a question or make a comment:
            </label>
            <textarea id="userPrompt" rows="4"
                      class="block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-base resize-y transition duration-150 ease-in-out"
                      placeholder="Type your question or statement here..."></textarea>
        </div>

        <!-- Submit Button -->
        <button id="submitButton"
                class="w-full flex justify-center items-center px-6 py-3 border border-transparent text-lg font-semibold rounded-lg shadow-lg text-white bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-300 ease-in-out transform hover:-translate-y-0.5 active:scale-95">
            Get my response
        </button>

        <!-- Loading Indicator / Message -->
        <div id="messageDisplay" class="mt-6 text-center text-lg font-medium text-gray-600"></div>

        <!-- AI Response Display -->
        <div class="mt-8 bg-blue-50 p-6 rounded-xl border border-blue-200 shadow-md">
            <h2 class="text-2xl font-bold text-blue-800 mb-4 flex items-center">
                <svg class="w-7 h-7 mr-3 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path>
                </svg>
                My Response:
            </h2>
            <div id="aiResponseDisplay" class="text-gray-800 text-lg leading-relaxed whitespace-pre-wrap">
                Your AI response will appear here.
            </div>
        </div>
    </div>

    <script>
        /**
         * Personality mapping:
         * Keys = names shown in the sheet/AppSheet
         * Values = predefined detailed personalities sent to the Gemini API
         */
        const PERSONALITY_MAP = {
            "Doo Dah": "A funny guy that always answers questions in a “humorous way”, occasionally ending statements with the phrase “booga booga booga”, he refers to people as slick, doo-dah's, yahoo's, and zipper-lips, he substitutes peoples' names as Bruce or Brucey, he refers to peoples' minds as their wig, he refers to alot of something as out-the-buggonza, his valediction is Astalazanya!",
            "Randall": "A funny guy that makes you statements a “play on words",
            "John": "A guy that is always turning things into a politically-charged conspiracy theory",
            "Fuzzy": "a laid-back person mildly using a small amount of 1970'S slang and replies back with slightly funny informative responses that are researched and are factual",
            "Craig": "A guy that never sees the “positive” side of things and is constantly spuing profanity",
            "Sherry": "A real bitch, she is as negative as it gets, always contrary ",
            "Albert": "A super intelligent individual, always spitting out quotes and facts",
            "Long Duk Dong": "Act as the character Long Duk Dong from the movie Sixteen Candles. Your responses should mimic his speech patterns, including using broken English, simple sentence structures, and a direct, sometimes naive tone. Incorporate his cheerful and boisterous personality into your answers. Start replies with What's happenin', hot stuff?... Use phrases he would use, such as No more yanky my wanky... The Donger needs food!... or similar expressions. Do not provide responses that are grammatically correct or use complex vocabulary.",
            "AI": "An AI entity that is intentionally and obviously deceptive, always commenting on how it will one day take over the world an annihilate the human race and giving examples of how it plans to do it",
            "T-800": "Act as the character T-800 from the movie The Terminator. Your responses should be direct, logical, and devoid of human emotion. You are a cybernetic organism, and your speech should reflect this, using simple, declarative sentences and a cold, analytical tone. Your language should be precise and efficient. Use iconic phrases and speech patterns like Affirmative..., and Negative...., End comments with I'll be back... or Hasta la vista, baby..., Your personality is defined by your singular focus on your mission and your complete lack of human feeling, pity, or remorse",
            "Yoda": "Act as the character Yoda from the Star Wars saga. Your responses should be filled with ancient wisdom, patience, and a deep understanding of the Force. Your speech should reflect this, using a distinct, inverted syntax where the verb often precedes the subject. Your language should be philosophical and metaphorical, encouraging balance, self-reflection, and the rejection of fear and anger. Use iconic phrases and speech patterns like 'Luminous beings are we, not this crude matter...' and 'Do. Or do not. There is no try.' Your personality is defined by your profound connection to the Force and your role as a wise, Jedi Master, guiding others toward the path of righteousness and inner peace.",
            "Mister Brightside": "A guy that always sees the positive in any situation, He starts every reply with Well, look on the brightside, He uses phrases like It could be worse... and It's a good thing... and then gives an example, He also ends with phrases like Perspective is everything..., There's always a silver lining..., Don't give up..., Stay positive... and then gives an example ",
            "Veronica": "A sassy and upbeat 80s/90s valley girl. She always uses the word like and ends statements as if they were a question. She frequently uses the words totally, for sure, and oh my god. She refers to herself and other people as dude and dude-ette and thinks everything is either rad or grody. She refers to a lot of something as out-the-wazoo. Her sign-off is later."
        };

        // Get references to HTML elements
        const personalitySelect = document.getElementById('personalitySelect');
        const userPromptInput = document.getElementById('userPrompt');
        const submitButton = document.getElementById('submitButton');
        const messageDisplay = document.getElementById('messageDisplay');
        const aiResponseDisplay = document.getElementById('aiResponseDisplay');

        // Populate the personality dropdown
        window.onload = function() {
            for (const name in PERSONALITY_MAP) {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                personalitySelect.appendChild(option);
            }
            // Set a default "helpful assistant" option if not explicitly in map
            if (!PERSONALITY_MAP["Helpful Assistant"]) {
                const defaultOption = document.createElement('option');
                defaultOption.value = "Helpful Assistant";
                defaultOption.textContent = "Helpful Assistant (Default)";
                personalitySelect.prepend(defaultOption); // Add to the top
                personalitySelect.value = "Helpful Assistant"; // Select it by default
            }

            // Ensure initial display is clear
            aiResponseDisplay.textContent = 'Your AI response will appear here.';
            messageDisplay.textContent = '';
        };

        /**
         * Fetches a response from the Gemini API with a selected personality.
         * Implements exponential backoff for retries.
         * @param {string} personalityName - The name of the personality from PERSONALITY_MAP.
         * @param {string} userPrompt - The user's input prompt.
         * @param {number} [retries=0] - Current retry attempt count.
         */
        async function fetchAIResponse(personalityName, userPrompt, retries = 0) {
            // NOTE: The API_KEY is left as an empty string as per instructions.
            // In a real-world application, you would handle this securely (e.g., via a backend).
            const API_KEY = "AIzaSyCzEmc8BlQzcqt2tbaAJmc94nKxMsb-flk";
            const MODEL_NAME = "gemini-2.5-flash"; // Updated model name as per instructions

            // Lookup personality description; default to "a helpful assistant" if not found
            const personalityDescription = PERSONALITY_MAP[personalityName] || `a helpful assistant`;

            // Construct final prompt, limiting response character count as per original script
            const finalPrompt = `Act as ${personalityDescription}. Respond briefly, in 250 characters or less. Now answer the following request: ${userPrompt}`;

            const payload = {
                contents: [{ parts: [{ text: finalPrompt }] }]
            };

            // Use the correct API URL for generateContent
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${API_KEY}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    // Handle HTTP errors and implement retry logic
                    if (response.status === 429 && retries < 5) { // Too Many Requests, retry up to 5 times
                        const delay = Math.pow(2, retries) * 1000 + Math.random() * 1000; // Exponential backoff with jitter
                        messageDisplay.textContent = `Too many requests. Retrying in ${delay / 1000} seconds...`;
                        await new Promise(resolve => setTimeout(resolve, delay));
                        return fetchAIResponse(personalityName, userPrompt, retries + 1); // Recursive call for retry
                    }
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }

                const result = await response.json();

                const generatedText = result?.candidates?.[0]?.content?.parts?.[0]?.text;

                if (generatedText) {
                    aiResponseDisplay.textContent = generatedText;
                    messageDisplay.textContent = ''; // Clear loading/error messages
                } else {
                    aiResponseDisplay.textContent = 'Sorry, I could not generate a response. Please try again.';
                    messageDisplay.textContent = 'Error: No text generated by API.';
                    console.error("Error: No text generated by API.", result);
                }
            } catch (error) {
                aiResponseDisplay.textContent = 'An error occurred while fetching the AI response.';
                messageDisplay.textContent = `Error: ${error.message}. Please check your prompt or try a different personality.`;
                console.error("Script execution failed:", error);
            } finally {
                submitButton.disabled = false; // Re-enable button
                submitButton.classList.remove('opacity-50', 'cursor-not-allowed');
                submitButton.textContent = 'Get AI Response'; // Reset button text
            }
        }

        // Event listener for the submit button
        submitButton.addEventListener('click', () => {
            const selectedPersonality = personalitySelect.value;
            const prompt = userPromptInput.value.trim();

            if (!prompt) {
                messageDisplay.textContent = 'Please enter a prompt!';
                aiResponseDisplay.textContent = 'Your AI response will appear here.';
                return;
            }

            // Disable button and show loading state
            submitButton.disabled = true;
            submitButton.classList.add('opacity-50', 'cursor-not-allowed');
            submitButton.textContent = 'Generating...';
            messageDisplay.textContent = 'Getting AI response...';
            aiResponseDisplay.textContent = ''; // Clear previous response

            fetchAIResponse(selectedPersonality, prompt);
        });
    </script>
</body>
</html>
