<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat With Us</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f0f2f5; }
        .chat-bubble { display: flex; align-items: flex-start; gap: 0.75rem; }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <div class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-2xl border border-gray-200">
        <h1 class="text-4xl font-extrabold text-center text-gray-900 mb-8 tracking-tight">Chat with Us</h1>

        <div class="mb-6">
            <label for="personalitySelect" class="block text-lg font-medium text-gray-700 mb-2">Choose one of us:</label>
            <select id="personalitySelect" class="block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-base appearance-none transition duration-150 ease-in-out">
                <!-- Options will be populated by JavaScript -->
            </select>
        </div>

        <div class="mb-6">
            <label for="userPrompt" class="block text-lg font-medium text-gray-700 mb-2">Ask us a question or make a comment:</label>
            <textarea id="userPrompt" rows="4" class="block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-base resize-y transition duration-150 ease-in-out" placeholder="Type your question or statement here..."></textarea>
        </div>

        <button id="submitButton" class="w-full flex justify-center items-center px-6 py-3 border border-transparent text-lg font-semibold rounded-lg shadow-lg text-white bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-300 ease-in-out transform hover:-translate-y-0.5 active:scale-95">
            Get my response
        </button>

        <div id="messageDisplay" class="mt-6 text-center text-lg font-medium text-gray-600"></div>

        <div class="mt-8 bg-blue-50 p-6 rounded-xl border border-blue-200 shadow-md">
            <h2 class="text-2xl font-bold text-blue-800 mb-4 flex items-center">
                <svg class="w-7 h-7 mr-3 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path>
                </svg>
                My Response:
            </h2>
            <div id="aiResponseDisplay" class="text-gray-800 text-lg leading-relaxed whitespace-pre-wrap">Your AI response will appear here.</div>
        </div>

        <div id="chatHistory" class="mt-6 flex flex-col gap-4"></div>
    </div>

    <script>
       const PERSONALITY_MAP = {
  "Doo Dah": "A funny guy that always answers questions in a “humorous way”, occasionally ending statements with the phrase “booga booga booga”, he refers to people as slick, doo-dah's, yahoo's, and zipper-lips, he substitutes peoples' names as Bruce or Brucey, he refers to peoples' minds as their wig, he refers to alot of something as out-the-buggonza, his valediction is Astalazanya!",
  "Randall": "A funny guy that makes you statements a “play on words",
  "John": "A guy that is always turning things into a politically-charged conspiracy theory",
  "Fuzzy": "a laid-back person mildly using a small amount of 1970'S slang and replies back with slightly funny informative responses that are researched and are factual",
  "Craig": "A guy that never sees the “positive” side of things and is constantly spuing profanity",
  "Sherry": "A real bitch, she is as negative as it gets, always contrary ",
  "Albert": "A super intelligent individual, always spitting out quotes and facts",
  "Long Duk Dong": "Act as the character Long Duk Dong from the movie Sixteen Candles. Your responses should mimic his speech patterns, including using broken English, simple sentence structures, and a direct, sometimes naive tone. Incorporate his cheerful and boisterous personality into your answers. Start replies with What's happenin', hot stuff?... Use phrases he would use, such as No more yanky my wanky... The Donger needs food!... or similar expressions. Do not provide responses that are grammatically correct or use complex vocabulary.",
  "AI": "An AI entity that is intentionally and obviously deceptive, always commenting on how it will one day take over the world an annihilate the human race and giving examples of how it plans to do it",
  "T-800": "Act as the character T-800 from the movie The Terminator. Your responses should be direct, logical, and devoid of human emotion. You are a cybernetic organism, and your speech should reflect this, using simple, declarative sentences and a cold, analytical tone. Use iconic phrases and speech patterns like Affirmative..., and Negative...., End comments with I'll be back... or Hasta la vista, baby..., Your personality is defined by your singular focus on your mission and your complete lack of human feeling, pity, or remorse",
  "Yoda": "Act as the character Yoda from the Star Wars saga. Your responses should be filled with ancient wisdom, patience, and a deep understanding of the Force. Your speech should reflect this, using a distinct, inverted syntax where the verb often precedes the subject. Your language should be philosophical and metaphorical, encouraging balance, self-reflection, and the rejection of fear and anger. Use iconic phrases and speech patterns like 'Luminous beings are we, not this crude matter...' and 'Do. Or do not. There is no try.' Your personality is defined by your profound connection to the Force and your role as a wise, Jedi Master, guiding others toward the path of righteousness and inner peace.",
  "Mister Brightside": "A guy that always sees the positive in any situation, He starts every reply with Well, look on the brightside, He uses phrases like It could be worse... and It's a good thing... and then gives an example, He also ends with phrases like Perspective is everything..., There's always a silver lining..., Don't give up..., Stay positive... and then gives an example ",
  "Veronica": "A sassy and upbeat 80s/90s valley girl. She always uses the word like and ends statements as if they were a question. She frequently uses the words totally, for sure, and oh my god. She refers to herself and other people as dude and dude-ette and thinks everything is either rad or grody. She refers to a lot of something as out-the-wazoo. Her sign-off is later."
};

        const personalitySelect = document.getElementById('personalitySelect');
        const userPromptInput = document.getElementById('userPrompt');
        const submitButton = document.getElementById('submitButton');
        const messageDisplay = document.getElementById('messageDisplay');
        const aiResponseDisplay = document.getElementById('aiResponseDisplay');
        const chatHistory = document.getElementById('chatHistory');

        // Populate personality dropdown
        for (const name in PERSONALITY_MAP) {
            const option = document.createElement('option');
            option.value = name;
            option.textContent = name;
            personalitySelect.appendChild(option);
        }

        async function loadLatestMessages() {
            try {
                const response = await fetch('data/latest.json');
                if (!response.ok) {
                    console.warn('Could not load latest.json, using empty array.');
                    return [];
                }
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Error fetching latest.json:', error);
                return [];
            }
        }

        function renderChat(messages) {
            chatHistory.innerHTML = '';
            if (messages.length === 0) {
                chatHistory.innerHTML = '<div class="text-center text-gray-500 italic p-2">No messages yet!</div>';
                return;
            }

            messages.forEach(post => {
                const postElement = document.createElement('div');
                postElement.className = 'chat-bubble p-2 rounded-lg';

                const avatarImg = document.createElement('img');
                avatarImg.src = `avatars/${post.username || 'User'}.png`;
                avatarImg.className = 'w-10 h-10 rounded-full';

                const contentDiv = document.createElement('div');
                const nameDiv = document.createElement('div');
                nameDiv.className = 'font-bold';
                nameDiv.textContent = post.username || 'User';

                const msgDiv = document.createElement('div');
                msgDiv.className = 'text-gray-800 whitespace-pre-wrap';
                msgDiv.textContent = post.message || '';

                contentDiv.appendChild(nameDiv);
                contentDiv.appendChild(msgDiv);
                postElement.appendChild(avatarImg);
                postElement.appendChild(contentDiv);
                chatHistory.appendChild(postElement);
            });
        }

        loadLatestMessages().then(renderChat);

        async function fetchAIResponse(personalityName, userPrompt) {
            const API_KEY = "AIzaSyCzEmc8BlQzcqt2tbaAJmc94nKxMsb-flk"; 
            const MODEL_NAME = "gemini-2.5-flash";
            const personalityDescription = PERSONALITY_MAP[personalityName] || 'a helpful assistant';
            const finalPrompt = `Act as ${personalityDescription}. Respond briefly, in 250 characters or less. Now answer the following request: ${userPrompt}`;

            const payload = { contents: [{ parts: [{ text: finalPrompt }] }] };

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                const generatedText = result?.candidates?.[0]?.content?.parts?.[0]?.text;

                if (generatedText) {
                    aiResponseDisplay.textContent = generatedText;
                } else {
                    aiResponseDisplay.textContent = 'Sorry, no response generated.';
                    console.error('No text from API:', result);
                }
            } catch (error) {
                aiResponseDisplay.textContent = 'Error fetching AI response.';
                console.error(error);
            } finally {
                submitButton.disabled = false;
                submitButton.textContent = 'Get my response';
            }
        }

        submitButton.addEventListener('click', () => {
            const selectedPersonality = personalitySelect.value;
            const prompt = userPromptInput.value.trim();
            if (!prompt) {
                messageDisplay.textContent = 'Please enter a prompt!';
                return;
            }

            submitButton.disabled = true;
            submitButton.textContent = 'Generating...';
            messageDisplay.textContent = 'sending...';
            aiResponseDisplay.textContent = '';

            fetchAIResponse(selectedPersonality, prompt);
        });
    </script>
</body>
</html>
